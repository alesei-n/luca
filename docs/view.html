<!DOCTYPE html>  <html> <head>   <title>view.coffee</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="base_toolbar.html">                 base_toolbar.coffee               </a>                                           <a class="source" href="button_field.html">                 button_field.coffee               </a>                                           <a class="source" href="checkbox_field.html">                 checkbox_field.coffee               </a>                                           <a class="source" href="file_upload_field.html">                 file_upload_field.coffee               </a>                                           <a class="source" href="hidden_field.html">                 hidden_field.coffee               </a>                                           <a class="source" href="select_field.html">                 select_field.coffee               </a>                                           <a class="source" href="text_area_field.html">                 text_area_field.coffee               </a>                                           <a class="source" href="text_field.html">                 text_field.coffee               </a>                                           <a class="source" href="type_ahead_field.html">                 type_ahead_field.coffee               </a>                                           <a class="source" href="filterable_collection.html">                 filterable_collection.coffee               </a>                                           <a class="source" href="form_button_toolbar.html">                 form_button_toolbar.coffee               </a>                                           <a class="source" href="form_view.html">                 form_view.coffee               </a>                                           <a class="source" href="grid_view.html">                 grid_view.coffee               </a>                                           <a class="source" href="bread_crumb_navigatiion.html">                 bread_crumb_navigatiion.coffee               </a>                                           <a class="source" href="template.html">                 template.coffee               </a>                                           <a class="source" href="card_view.html">                 card_view.coffee               </a>                                           <a class="source" href="column_view.html">                 column_view.coffee               </a>                                           <a class="source" href="modal_view.html">                 modal_view.coffee               </a>                                           <a class="source" href="panel_view.html">                 panel_view.coffee               </a>                                           <a class="source" href="split_view.html">                 split_view.coffee               </a>                                           <a class="source" href="tab_view.html">                 tab_view.coffee               </a>                                           <a class="source" href="viewport.html">                 viewport.coffee               </a>                                           <a class="source" href="collection.html">                 collection.coffee               </a>                                           <a class="source" href="container.html">                 container.coffee               </a>                                           <a class="source" href="field.html">                 field.coffee               </a>                                           <a class="source" href="view.html">                 view.coffee               </a>                                           <a class="source" href="framework.html">                 framework.coffee               </a>                                           <a class="source" href="collection_manager.html">                 collection_manager.coffee               </a>                                           <a class="source" href="socket_manager.html">                 socket_manager.coffee               </a>                                           <a class="source" href="deferrable.html">                 deferrable.coffee               </a>                                           <a class="source" href="local_storage.html">                 local_storage.coffee               </a>                                           <a class="source" href="spin.html">                 spin.coffee               </a>                                           <a class="source" href="toolbars.html">                 toolbars.coffee               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               view.coffee             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <h3>Luca Base View</h3>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">Luca.View = </span><span class="nx">Backbone</span><span class="p">.</span><span class="nx">View</span><span class="p">.</span><span class="nx">extend</span>
  <span class="nv">base: </span><span class="s1">&#39;Luca.View&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>The Luca.View class adds some very commonly used patterns
and functionality to the stock Backbone.View class. Features
such as auto event binding, the facilitation of deferred rendering
against a Backbone.Model or Backbone.Collection reset event, Caching
views into a global Component Registry, and more.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">Luca.View.originalExtend = </span><span class="nx">Backbone</span><span class="p">.</span><span class="nx">View</span><span class="p">.</span><span class="nx">extend</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>By overriding Backbone.View.extend we are able to intercept
some method definitions and add special behavior around them
mostly related to render()</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">Luca.View.extend = </span><span class="nf">(definition)-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <h3>Rendering</h3>

<p>Our base view class wraps the defined render() method
of the views which inherit from it, and does things like
trigger the before and after render events automatically.
In addition, if the view has a deferrable property on it
then it will make sure that the render method doesn't get called
until.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">_base = </span><span class="nx">definition</span><span class="p">.</span><span class="nx">render</span>

  <span class="nx">_base</span> <span class="o">||=</span> <span class="nf">()-&gt;</span>
    <span class="nv">container = </span><span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isFunction</span><span class="p">(</span><span class="nx">@container</span><span class="p">)</span> <span class="k">then</span> <span class="nx">@container</span><span class="p">()</span> <span class="k">else</span> <span class="nx">@container</span> 

    <span class="k">return</span> <span class="err">@</span> <span class="nx">unless</span> <span class="nx">$</span><span class="p">(</span><span class="nx">container</span><span class="p">)</span> <span class="o">and</span> <span class="nx">$</span><span class="p">(</span><span class="nx">@el</span><span class="p">)</span> 


    <span class="nx">$</span><span class="p">(</span><span class="nx">container</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span> <span class="nx">$</span><span class="p">(</span><span class="nx">@el</span><span class="p">)</span> <span class="p">)</span>
    <span class="err">@</span>
    

  <span class="nv">definition.render = </span><span class="nf">()-&gt;</span>
    <span class="k">if</span> <span class="nx">@deferrable</span>
      <span class="nx">@trigger</span> <span class="s2">&quot;before:render&quot;</span><span class="p">,</span> <span class="err">@</span>
      
      <span class="nx">@deferrable</span><span class="p">.</span><span class="nx">bind</span> <span class="nx">@deferrable_event</span><span class="p">,</span> <span class="nx">_</span><span class="p">.</span><span class="nx">once</span> <span class="p">()</span><span class="o">=&gt;</span>
        <span class="nx">_base</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="err">@</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">)</span>
        <span class="nx">@trigger</span> <span class="s2">&quot;after:render&quot;</span><span class="p">,</span> <span class="err">@</span>
     </pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>we might not want to fetch immediately upon 
rendering, so we can pass a deferrable_trigger
event and not fire the fetch until this event
occurs</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="o">!</span><span class="nx">@deferrable_trigger</span>
        <span class="vi">@immediate_trigger = </span><span class="kc">true</span>
      
      <span class="k">if</span> <span class="nx">@immediate_trigger</span> <span class="o">is</span> <span class="kc">true</span>
        <span class="nx">@deferrable</span><span class="p">.</span><span class="nx">fetch</span><span class="p">()</span>
      <span class="k">else</span>
        <span class="nx">@bind</span> <span class="nx">@deferrable_trigger</span><span class="p">,</span> <span class="nx">_</span><span class="p">.</span><span class="nx">once</span> <span class="p">()</span><span class="o">=&gt;</span>
          <span class="nx">@deferrable</span><span class="p">.</span><span class="nx">fetch</span><span class="p">()</span>

    <span class="k">else</span>
      <span class="nx">@trigger</span> <span class="s2">&quot;before:render&quot;</span><span class="p">,</span> <span class="err">@</span>
      <span class="nx">_base</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="err">@</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">)</span>
      <span class="nx">@trigger</span> <span class="s2">&quot;after:render&quot;</span><span class="p">,</span> <span class="err">@</span>

  <span class="nx">Luca</span><span class="p">.</span><span class="nx">View</span><span class="p">.</span><span class="nx">originalExtend</span><span class="p">.</span><span class="nx">apply</span> <span class="err">@</span><span class="p">,</span> <span class="p">[</span><span class="nx">definition</span><span class="p">]</span>

<span class="nx">_</span><span class="p">.</span><span class="nx">extend</span> <span class="nx">Luca</span><span class="p">.</span><span class="nx">View</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span>
  <span class="nv">debug: </span><span class="nf">()-&gt;</span>
    <span class="k">return</span> <span class="nx">unless</span> <span class="nx">@debugMode</span> <span class="o">or</span> <span class="nb">window</span><span class="p">.</span><span class="nx">LucaDebugMode</span><span class="o">?</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="p">[(</span><span class="nx">@name</span> <span class="o">||</span> <span class="nx">@cid</span><span class="p">),</span><span class="nx">message</span><span class="p">]</span> <span class="k">for</span> <span class="nx">message</span> <span class="k">in</span> <span class="nx">arguments</span>

  <span class="nv">trigger: </span><span class="nf">(@event)-&gt;</span>
    <span class="nx">Backbone</span><span class="p">.</span><span class="nx">View</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">trigger</span><span class="p">.</span><span class="nx">apply</span> <span class="err">@</span><span class="p">,</span> <span class="nx">arguments</span>

  <span class="nx">hooks</span><span class="o">:</span><span class="p">[</span>
    <span class="s2">&quot;after:initialize&quot;</span>
    <span class="s2">&quot;before:render&quot;</span>
    <span class="s2">&quot;after:render&quot;</span>
    <span class="s2">&quot;first:activation&quot;</span>
    <span class="s2">&quot;activation&quot;</span>
    <span class="s2">&quot;deactivation&quot;</span>
  <span class="p">]</span>
  </pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>which event should we listen to on
our deferrable property, before we
trigger the actual rendering  </p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">deferrable_event: </span><span class="s2">&quot;reset&quot;</span>

  <span class="nv">initialize: </span><span class="nf">(@options={})-&gt;</span>
    <span class="vi">@cid = </span><span class="nx">_</span><span class="p">.</span><span class="nx">uniqueId</span><span class="p">(</span><span class="nx">@name</span><span class="p">)</span> <span class="k">if</span> <span class="nx">@name</span><span class="o">?</span>

    <span class="nx">_</span><span class="p">.</span><span class="nx">extend</span> <span class="err">@</span><span class="p">,</span> <span class="nx">@options</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <h3>View Caching</h3>

<p>Luca.View(s) which get created get stored in a global cache by their
component id.  This allows us to re-use views when it makes sense</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">Luca</span><span class="p">.</span><span class="nx">cache</span><span class="p">(</span> <span class="nx">@cid</span><span class="p">,</span> <span class="err">@</span> <span class="p">)</span>
    
    <span class="nv">unique = </span><span class="nx">_</span><span class="p">(</span> <span class="nx">Luca</span><span class="p">.</span><span class="nx">View</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">hooks</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span> <span class="nx">@hooks</span> <span class="p">)</span> <span class="p">).</span><span class="nx">uniq</span><span class="p">()</span>
    
    <span class="nx">@setupHooks</span><span class="p">(</span> <span class="nx">unique</span> <span class="p">)</span>

    <span class="nx">@trigger</span> <span class="s2">&quot;after:initialize&quot;</span><span class="p">,</span> <span class="err">@</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <h3>Hooks or Auto Event Binding</h3>

<p>views which inherit from Luca.View can define hooks
or events which can be emitted from them.  Automatically,
any functions on the view which are named according to the
convention will automatically get run.  </p>

<p>by default, all Luca.View classes come with the following:</p>

<p>before:render     : beforeRender()
after:render      : afterRender()
after:initialize  : afterInitialize()
first:activation  : firstActivation()</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">setupHooks: </span><span class="nf">(set)-&gt;</span>
    <span class="nx">set</span> <span class="o">||=</span> <span class="nx">@hooks</span>
    
    <span class="nx">_</span><span class="p">(</span><span class="nx">set</span><span class="p">).</span><span class="nx">each</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span><span class="o">=&gt;</span>
      <span class="nv">parts = </span><span class="nx">event</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
      <span class="nv">prefix = </span><span class="nx">parts</span><span class="p">.</span><span class="nx">shift</span><span class="p">()</span>
      
      <span class="nv">parts = </span><span class="nx">_</span><span class="p">(</span> <span class="nx">parts</span> <span class="p">).</span><span class="nx">map</span> <span class="nf">(p)-&gt;</span> <span class="nx">_</span><span class="p">.</span><span class="nx">capitalize</span><span class="p">(</span><span class="nx">p</span><span class="p">)</span>
      <span class="nv">fn = </span><span class="nx">prefix</span> <span class="o">+</span> <span class="nx">parts</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
      
      <span class="nx">@bind</span> <span class="nx">event</span><span class="p">,</span> <span class="p">()</span><span class="o">=&gt;</span> <span class="err">@</span><span class="p">[</span><span class="nx">fn</span><span class="p">].</span><span class="nx">apply</span> <span class="err">@</span><span class="p">,</span> <span class="nx">arguments</span> <span class="k">if</span> <span class="err">@</span><span class="p">[</span><span class="nx">fn</span><span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <h3>Luca.Collection and Luca.CollectionManager integration</h3>

<p>One really cool feature of Luca is the enhanced API for binding
to views.  Using an API very similar to the DOM @events property
on Backbone views.  If you are using Luca.Collection classes 
and a Luca.CollectionManager to track them, you can use the
@collectionEvents property on your views like such:</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>App.Manager = new Luca.CollectionManager()</p>

<p>App.Collection = new Luca.SampleCollection
  registerWith: "App.Manager"
  registerAs: "sample_collection"</p>

<p>App.View = Luca.View.extend
  collectionEvents:
    "sample_collection add" : "onCollectionAdd"</p>

<p>onCollectionAdd: (model,collection)->
    @doSomethingRighteous()</p>

<p>under the hood, this will find your collection manager using 
Luca.CollectionManager.get, which is a function that returns
the first instance of the CollectionManager class ever created.</p>

<p>if you want to use more than one collection manager, over ride this
function in your views with your own logic</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">getCollectionManager: </span><span class="nf">()-&gt;</span> 
    <span class="nx">Luca</span><span class="p">.</span><span class="nx">CollectionManager</span><span class="p">.</span><span class="nx">get</span><span class="o">?</span><span class="p">.</span><span class="nx">call</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <h4>Collection Events</h4>

<p>By defining a hash of collectionEvents in the form of</p>

<p>"collectionManagerKey collectionEvent" : "functionName"</p>

<p>the Luca.View will bind to the collection found in the 
collectionManager with that key, and bind to that event</p>

<p>in the example:</p>

<p>collectionEvents:
  "books add" : "onBookAdd"</p>

<p>then a property of @booksCollection will be created on the view, 
and the "add" event will trigger "onBookAdd"</p>

<p>you may also specify a function directly.  this </p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">registerCollectionEvents: </span><span class="nf">()-&gt;</span>
    <span class="nv">manager = </span><span class="nx">@getCollectionManager</span><span class="p">()</span>

    <span class="nx">_</span><span class="p">(</span> <span class="nx">@collectionEvents</span> <span class="p">).</span><span class="nx">each</span> <span class="p">(</span><span class="nx">handler</span><span class="p">,</span> <span class="nx">signature</span><span class="p">)</span><span class="o">=&gt;</span>
      <span class="p">[</span><span class="nx">key</span><span class="p">,</span><span class="nx">event</span><span class="p">]</span> <span class="o">=</span> <span class="nx">signature</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>

      <span class="nv">collection = </span><span class="err">@</span><span class="p">[</span><span class="s2">&quot;#{ key }Collection&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nx">manager</span><span class="p">.</span><span class="nx">getOrCreate</span><span class="p">(</span> <span class="nx">key</span> <span class="p">)</span>

      <span class="k">if</span> <span class="o">!</span><span class="nx">collection</span> 
        <span class="k">throw</span> <span class="s2">&quot;Could not find collection specified by #{ key }&quot;</span> 

      <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isFunction</span><span class="p">(</span><span class="nx">handler</span><span class="p">)</span>
        <span class="nv">handler = </span><span class="p">()</span><span class="o">=&gt;</span> <span class="nx">handler</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="err">@</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">)</span>
      <span class="k">else</span>
        <span class="nv">handler = </span><span class="err">@</span><span class="p">[</span><span class="nx">handler</span><span class="p">]</span>

      <span class="nx">unless</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isFunction</span><span class="p">(</span><span class="nx">handler</span><span class="p">)</span>
        <span class="k">throw</span> <span class="s2">&quot;invalid collectionEvents configuration&quot;</span>

      <span class="k">try</span>
        <span class="nx">collection</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">handler</span><span class="p">)</span>
      <span class="k">catch</span> <span class="nx">e</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="s2">&quot;Error Binding To Collection in registerCollectionEvents&quot;</span><span class="p">,</span> <span class="err">@</span>
        <span class="k">throw</span> <span class="nx">e</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 